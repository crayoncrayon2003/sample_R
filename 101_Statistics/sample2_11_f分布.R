main <- function() {
  cat("########################################################################\n")
  cat("F分布\n")
  cat("2つの独立なカイ二乗分布の比から定義される、分散の比を表す連続分布\n")

  # ２つの母集団の分散 σ₁²、σ₂² は未知であることが多く、それらを直接求めることは困難である。
  # それぞれの母集団が正規分布に従うと仮定し、大きさn1, n2の独立な標本から、それぞれS1²、S2²を求めると、
  # 統計量Ｆ = (S1²σ₁²) / (S2²σ₁²)は、自由度（n1-1, n2-1）のＦ分布に従う。
  # この統計量 F を用いて 2つの母分散の等しさを検定する。

  # 例１：あるテストの点数は正規分布に従うと考えられている。
  # 　　　クラスAの学生 6 人と、クラスBの学生 11 人の点数を測定し、
  # 　　　それぞれの標本分散 S_A^2、S_B^2 を求めた。
  #
  # 　　　母分散が等しいかを調べるために
  # 　　　F = S_A^2 / S_B^2
  # 　　　という統計量を考えると、この F は
  # 　　　分子の自由度 5、分母の自由度 10 の F分布に従う。

  # 例２：ある製品の重量は正規分布に従うと仮定されている。
  # 　　　生産ラインAから 6 個、ラインBから 11 個の製品を抽出し、
  # 　　　それぞれの標本分散 S_A^2、S_B^2 を求めた。
  #
  # 　　　2つの生産ラインのばらつき（分散）が同じかどうかを調べるため、
  # 　　　F = S_A^2 / S_B^2
  # 　　　という統計量を用いると、この F は
  # 　　　分子の自由度 5、分母の自由度 10 の F分布に従う。


  d1 <- 5   # 分子の自由度
  d2 <- 10  # 分母の自由度

  # --- 理論値（存在条件つき） ---
  E_theory <- if (d2 > 2) d2 / (d2 - 2) else NA
  V_theory <- if (d2 > 4) {
    2 * d2^2 * (d1 + d2 - 2) / (d1 * (d2 - 2)^2 * (d2 - 4))
  } else NA

  cat("期待値（理論） :", E_theory, "\n")
  cat("分散（理論）   :", V_theory, "\n")


  # --- df：確率密度関数による確認 ---
  # 数値積分は上限を有限値にする（F分布は裾が重い）
  E_df <- integrate(
    function(x) x * df(x, df1 = d1, df2 = d2),
    0, 100
  )$value

  V_df <- integrate(
    function(x) (x - E_df)^2 * df(x, df1 = d1, df2 = d2),
    0, 100
  )$value

  cat("期待値（df） :", E_df, "\n")
  cat("分散（df）   :", V_df, "\n")


  # --- pf：累積分布関数 ---
  x0 <- 2
  pk <- pf(x0, df1 = d1, df2 = d2)
  cat("P(X ≤", x0, ") =", pk, "\n")


  # --- qf：分位点 ---
  alpha <- 0.95
  q <- qf(alpha, df1 = d1, df2 = d2)
  cat(alpha * 100, "% 分位点 =", q, "\n")


  # --- rf：乱数生成 ---
  set.seed(123)
  samples <- rf(1000, df1 = d1, df2 = d2)
  cat("シミュレーション結果（X を1000回観測）\n")


  # --- 可視化：ヒストグラム + 理論密度 ---
  hist(
    samples,
    probability = TRUE,
    col = "lightgray",
    border = "white",
    xlim = c(0, 5),
    xlab = "値",
    ylab = "密度",
    main = paste("F分布（df1 =", d1, ", df2 =", d2, "）")
  )

  curve(
    df(x, df1 = d1, df2 = d2),
    from = 0,
    to = 5,
    col = "red",
    lwd = 2,
    add = TRUE
  )
}

main()
