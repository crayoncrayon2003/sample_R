#　変数の種類は、大きく分けて４種類。ある１つの変数は、次のいすれかの特徴を持つ。
#
# 　　　質的　│　量的
# 離散　１　　│　２
# ーーーーーー┼ーーーーーー
# 連続　３　　│　４
# ーーーーーー┼ーーーーーー
# １. 質的 × 離散（存在する） ：　性別（男／女）、色（赤／緑／青）
# ２. 量的 × 離散（存在する） ：　人数（来店数など、1人、20人）、個数（不良品など、2個、3個）
# ３. 質的 × 連続（存在しない）
# ４. 量的 × 連続（存在する） ：　身長（160cm、170cm）、売上金額（700万円、600万円）

# y = f(x)のイメージで、y目的変数をx説明変数で表現すると以下になる。
# 言いたいことは、次の２つ。
#  * １つの変数が、それぞれいずれかの種類に該当する
#  * 目的変数と説明変数の種類の組み合わせで、よく使われる分析手法が異なる。
# 目的変数（y）| 説明変数（x）| よく使われる分析手法　　　　|
# ーーーーーー ┼ ーーーーーー ┼  ーーーーーーーーーーーーー |
# 量的 × 連続　| 質的 × 離散　| t検定、ANOVA     　　　　 |
# 量的 × 連続　| 量的 × 連続　| 回帰分析          　　　　|
# 量的 × 離散　| 質的 × 離散　| 順序ロジット、ポアソン回帰 |
# 質的 × 離散　| 質的 × 離散　| クロス集計、カイ二乗検定   |
# 質的 × 離散　| 量的 × 連続　| ロジスティック回帰     　　|


main <- function() {
  #　E[Y | X1] は、処置 X1 と結果 Y の関連を表すが、必ずしも因果効果を表していない。
  #　
  #　X1（風邪薬あり／風邪薬なし）と Y（治った／治らなかった）の両方に影響を与える第3の変数 X2（軽症／重症）が存在すると、
  #　E[Y | X1] は X1 の因果効果を正しく反映せず、歪められる。
  #　このとき、X2 を交絡変数（confounder）と呼ぶ。
  #　歪みを除去するために、交絡変数 X2 で条件付けた多変量条件付き期待値E[Y | X1, X2] を考える。
  #      ただし、X2以外に交絡変数が存在しないと言い切れない。
  #      未観測交絡があるかもしれないための道具が、ランダム化比較試験、操作変数、差の差、回帰不連続、感度分析などがある。



  # サンプルデータ作成
  df <- data.frame(
    # 結果変数 Y
    # 1: 治った, 0: 治らなかった
    y = c(
      1,1,1,1,0,0,   # 風邪薬あり・安静あり
      1,0,0,0,0,0,   # 風邪薬あり・安静なし
      1,1,0,0,0,0,   # 風邪薬なし・安静あり
      0,0,0,0,0,0    # 風邪薬なし・安静なし
    ),
    # 説明変数 X1（風邪薬）
    x1 = c(
      rep(1, 6),  # 風邪薬あり
      rep(1, 6),  # 風邪薬あり
      rep(0, 6),  # 風邪薬なし
      rep(0, 6)   # 風邪薬なし
    ),

    # 説明変数 X2（安静）
    x2 = c(
      rep(1, 6),  # 安静あり
      rep(0, 6),  # 安静なし
      rep(1, 6),  # 安静あり
      rep(0, 6)   # 安静なし
    )
  )

  print(df)

  ## ===============================
  ## 条件付き期待値
  ## ===============================

  # 風邪薬あり・安静ありの結果、治った
  # P(Y=1 | X1=1, X2=1) = 条件付き期待値 E[Y | X1=1, X2=1]
  e_y1_x1_1_x2_1 <- mean(df$y[df$x1 == 1 & df$x2 == 1])

  # 風邪薬あり・安静なしの結果、治った
  # P(Y=1 | X1=1, X2=0) = 条件付き期待値 E[Y | X1=1, X2=0]
  e_y1_x1_1_x2_0 <- mean(df$y[df$x1 == 1 & df$x2 == 0])

  # 風邪薬なし・安静ありの結果、治った
  # P(Y=1 | X1=0, X2=1) = 条件付き期待値 E[Y | X1=0, X2=1]
  e_y1_x1_0_x2_1 <- mean(df$y[df$x1 == 0 & df$x2 == 1])

  # 風邪薬なし・安静なしの結果、治った
  # P(Y=1 | X1=0, X2=0) = 条件付き期待値 E[Y | X1=0, X2=0]
  e_y1_x1_0_x2_0 <- mean(df$y[df$x1 == 0 & df$x2 == 0])


  ## ===============================
  ## 条件付き分散
  ## ===============================

  # Var(Y | X1=1, X2=1)
  var_y_x1_1_x2_1 <- e_y1_x1_1_x2_1 * (1 - e_y1_x1_1_x2_1)

  # Var(Y | X1=1, X2=0)
  var_y_x1_1_x2_0 <- e_y1_x1_1_x2_0 * (1 - e_y1_x1_1_x2_0)

  # Var(Y | X1=0, X2=1)
  var_y_x1_0_x2_1 <- e_y1_x1_0_x2_1 * (1 - e_y1_x1_0_x2_1)

  # Var(Y | X1=0, X2=0)
  var_y_x1_0_x2_0 <- e_y1_x1_0_x2_0 * (1 - e_y1_x1_0_x2_0)


  ## ===============================
  ## 出力
  ## ===============================

  cat("E[Y | X1=1, X2=1] =", e_y1_x1_1_x2_1, "\n")
  cat("Var(Y | X1=1, X2=1) =", var_y_x1_1_x2_1, "\n\n")

  cat("E[Y | X1=1, X2=0] =", e_y1_x1_1_x2_0, "\n")
  cat("Var(Y | X1=1, X2=0) =", var_y_x1_1_x2_0, "\n\n")

  cat("E[Y | X1=0, X2=1] =", e_y1_x1_0_x2_1, "\n")
  cat("Var(Y | X1=0, X2=1) =", var_y_x1_0_x2_1, "\n\n")

  cat("E[Y | X1=0, X2=0] =", e_y1_x1_0_x2_0, "\n")
  cat("Var(Y | X1=0, X2=0) =", var_y_x1_0_x2_0, "\n")


  cat("n人の人がいるとき、ある一人に関して、説明変数が x1, x2の場合、次の4つを 潜在反応変数 と呼ぶ。", "\n")
  cat("* Y(1,1) : 風邪薬あり・安静あり の場合の結果", "\n")
  cat("* Y(1,0) : 風邪薬あり・安静なし の場合の結果", "\n")
  cat("* Y(0,1) : 風邪薬なし・安静あり の場合の結果", "\n")
  cat("* Y(0,0) : 風邪薬なし・安静なし の場合の結果", "\n")

  cat("実際に観測されたのが x1=1, x2=1の時、Y = Y(1,1)となって、以下の3つパターンは、実際に観測できない。", "\n")
  cat("* Y(1,0) : 風邪薬あり・安静なし の場合の結果", "\n")
  cat("* Y(0,1) : 風邪薬なし・安静あり の場合の結果", "\n")
  cat("* Y(0,0) : 風邪薬なし・安静なし の場合の結果", "\n")
  cat("観測できたY = Y(1,1) は、潜在反応変数のうち1つが実現した結果変数である。", "\n")

}


main()
